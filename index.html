<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>窩不知道</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #DAB6E8; } 
    </style>
</head>
<body class="min-h-screen">
  <header class="bg-white shadow-md">
    <h1 class="text-3xl font-bold py-4 px-6 text-gray-800">窩不知道</h1>
  </header>
    
    <div id="list" class="p-8 flex flex-wrap gap-6 justify-start">
        <p id="loading-message" class="text-gray-600 text-lg">文章載入中，請稍候...</p>
    </div>
    
    <script>
        // 完整的API URL (假設後端運行在 8000 埠)
        const POSTS_API_URL = 'http://127.0.0.1:8000/api/posts'; 
        
        // 獲取正確的DOM元素
        const container = document.getElementById('list'); // 修正 ID
        const loadingMessage = document.getElementById('loading-message'); 

        /**
         * 根據單篇文章資料生成對應的HTML字串
         */
        function createCardHTML(post,summary) {
            return `
            <div class="w-72 bg-white rounded-xl shadow-lg overflow-hidden flex-shrink-0 transition duration-300 hover:shadow-xl hover:-translate-y-1">
    <a href="./post.html?slug=${post.slug}" class="block"> 
        
        <div class="h-40 bg-gray-300">
            <img 
                src="${post.image_url}" 
                alt="${post.title}" 
                onerror="this.onerror=null; this.src='https://via.placeholder.com/288x160/D3D3D3/000000?text=Image+Load+Error';"
                class="w-full h-full object-cover"
            >
        </div>
        
        <div class="p-4">
            <h2 class="text-xl font-bold text-black mb-1 leading-tight">
                ${post.title}
            </h2>
            
            <p class="text-sm font-medium text-gray-700 mb-2">
                作者: ${post.author}
            </p>
            
            <p class="text-sm text-gray-500">
                內容摘要: ${summary}
            </p>
        </div>
        
    </a>
</div>
            `;
        }

        /**
         * 獲取資料並渲染的核心邏輯
         */
        async function fetchAndRenderPosts() {
            // 移除載入訊息
            if (loadingMessage) {
                loadingMessage.remove();
            }

            try {
                // 執行 fetch 請求
                const response = await fetch(POSTS_API_URL);
                
                if (!response.ok) {
                    throw new Error(`API 請求失敗: 狀態碼 ${response.status}. 請確認後端是否啟動。`);
                }

                const posts = await response.json();

                if (posts.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-lg p-4">目前資料庫中沒有文章數據，請檢查 init_database 函數。</p>';
                    return;
                }

                // 遍歷數據並生成 HTML
                const cardsHTML = posts.map(post => {
                // 摘要：取content的前幾個字
                const fullContent = post.content || ""; 
                const summary = fullContent.substring(0, 30) + (fullContent.length > 30 ? '...' : '');

                // 呼叫創建卡片函數，並傳入計算好的 summary
                return createCardHTML(post, summary);}).join('');

                // 插入到 DOM 中
                container.innerHTML = cardsHTML;

            } catch (error) {
                console.error("載入文章失敗:", error);
                // 顯示錯誤訊息
                container.innerHTML = `<p class="text-red-600 text-lg p-4">載入文章失敗。錯誤: ${error.message}</p>`;
            }
        }

        // 頁面載入後執行
        fetchAndRenderPosts();
    </script>
</body>
</html>